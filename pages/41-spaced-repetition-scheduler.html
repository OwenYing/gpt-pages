<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spaced Repetition Scheduler - GPT Static Pages</title>
    <link rel="stylesheet" href="../styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .scheduler-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .deck-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .deck-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .deck-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .deck-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .deck-btn {
            padding: 12px 20px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .deck-btn:hover {
            border-color: var(--primary-color);
            background: var(--primary-color);
            color: white;
        }
        
        .deck-btn.primary {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .deck-btn.primary:hover {
            background: var(--primary-dark);
        }
        
        .deck-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .deck-card {
            background: var(--bg-tertiary);
            padding: 25px;
            border-radius: 12px;
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .deck-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .deck-card.selected {
            border-color: var(--primary-color);
            background: rgba(99, 102, 241, 0.1);
        }
        
        .deck-name {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 10px;
        }
        
        .deck-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .deck-progress {
            width: 100%;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .deck-progress-bar {
            height: 100%;
            background: var(--primary-color);
            transition: width 0.3s ease;
        }
        
        .deck-actions {
            display: flex;
            gap: 10px;
        }
        
        .deck-action-btn {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: white;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }
        
        .deck-action-btn:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        .study-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .study-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .study-title {
            font-size: 2rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .study-subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }
        
        .card-display {
            background: var(--bg-tertiary);
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .card-content {
            max-width: 600px;
        }
        
        .card-question {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .card-answer {
            font-size: 1.3rem;
            color: var(--text-secondary);
            line-height: 1.6;
            display: none;
        }
        
        .card-answer.show {
            display: block;
        }
        
        .card-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .card-btn {
            padding: 15px 30px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .card-btn.show-answer {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .card-btn.show-answer:hover {
            background: var(--primary-dark);
        }
        
        .card-btn.difficulty {
            min-width: 120px;
        }
        
        .card-btn.easy {
            border-color: #10b981;
            color: #10b981;
        }
        
        .card-btn.easy:hover {
            background: #10b981;
            color: white;
        }
        
        .card-btn.medium {
            border-color: #f59e0b;
            color: #f59e0b;
        }
        
        .card-btn.medium:hover {
            background: #f59e0b;
            color: white;
        }
        
        .card-btn.hard {
            border-color: #ef4444;
            color: #ef4444;
        }
        
        .card-btn.hard:hover {
            background: #ef4444;
            color: white;
        }
        
        .study-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .stat-item {
            background: var(--bg-tertiary);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 8px;
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .add-card-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .add-card-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 25px;
            text-align: center;
        }
        
        .add-card-form {
            display: grid;
            gap: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .form-group label {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .form-group input, .form-group textarea, .form-group select {
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .form-btn {
            padding: 12px 24px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }
        
        .form-btn:hover {
            border-color: var(--primary-color);
            background: var(--primary-color);
            color: white;
        }
        
        .form-btn.primary {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .form-btn.primary:hover {
            background: var(--primary-dark);
        }
        
        .schedule-info {
            background: var(--bg-tertiary);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .schedule-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .schedule-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .schedule-day {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
        }
        
        .schedule-count {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--primary-color);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: var(--border-radius);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .back-button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .page-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        .page-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 0;
            background: var(--gradient-primary);
            color: white;
            border-radius: var(--border-radius);
            position: relative;
            overflow: hidden;
        }
        
        .page-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="50" cy="10" r="0.5" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.3;
        }
        
        .page-header-content {
            position: relative;
            z-index: 2;
        }
        
        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 16px;
            font-family: 'Space Grotesk', sans-serif;
        }
        
        .page-meta {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .page-category-badge {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .page-number-badge {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .content-section {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: var(--shadow-md);
        }
        
        @media (max-width: 768px) {
            .deck-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .deck-controls {
                justify-content: center;
            }
            
            .deck-grid {
                grid-template-columns: 1fr;
            }
            
            .card-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .card-btn {
                width: 100%;
                max-width: 300px;
                justify-content: center;
            }
            
            .study-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <a href="../index.html" class="back-button">
        <i class="fas fa-arrow-left"></i> Back to Hub
    </a>
    
    <div class="container">
        <div class="page-content">
            <!-- Page Header -->
            <div class="page-header">
                <div class="page-header-content">
                    <h1 class="page-title">Spaced Repetition Scheduler</h1>
                    <div class="page-meta">
                        <span class="page-category-badge">Education & Learning</span>
                        <span class="page-number-badge">Page #41</span>
                    </div>
                </div>
            </div>

            <!-- Introduction -->
            <div class="content-section">
                <p>Master any subject with scientifically-proven spaced repetition learning. Create custom decks, schedule review sessions, and track your progress to optimize long-term retention.</p>
            </div>

            <!-- Deck Management -->
            <div class="content-section">
                <div class="deck-section">
                    <div class="deck-header">
                        <h2 class="deck-title">Your Study Decks</h2>
                        <div class="deck-controls">
                            <button class="deck-btn" id="createDeckBtn">
                                <i class="fas fa-plus"></i> Create Deck
                            </button>
                            <button class="deck-btn" id="importDeckBtn">
                                <i class="fas fa-upload"></i> Import
                            </button>
                            <button class="deck-btn primary" id="startStudyBtn">
                                <i class="fas fa-play"></i> Start Study Session
                            </button>
                        </div>
                    </div>
                    
                    <div class="deck-grid" id="deckGrid">
                        <!-- Decks will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Study Session -->
            <div class="content-section" id="studySection" style="display: none;">
                <div class="study-section">
                    <div class="study-header">
                        <h2 class="study-title">Study Session</h2>
                        <p class="study-subtitle">Review your cards and rate your confidence</p>
                    </div>
                    
                    <div class="card-display" id="cardDisplay">
                        <div class="card-content">
                            <div class="card-question" id="cardQuestion">Select a deck to begin studying</div>
                            <div class="card-answer" id="cardAnswer"></div>
                        </div>
                    </div>
                    
                    <div class="card-actions" id="cardActions">
                        <button class="card-btn show-answer" id="showAnswerBtn">
                            <i class="fas fa-eye"></i> Show Answer
                        </button>
                    </div>
                    
                    <div class="study-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="cardsReviewed">0</div>
                            <div class="stat-label">Cards Reviewed</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="sessionStreak">0</div>
                            <div class="stat-label">Session Streak</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="accuracyRate">0%</div>
                            <div class="stat-label">Accuracy Rate</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="timeSpent">0m</div>
                            <div class="stat-label">Time Spent</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add Card Section -->
            <div class="content-section" id="addCardSection" style="display: none;">
                <div class="add-card-section">
                    <h2 class="add-card-title">Add New Card</h2>
                    
                    <form class="add-card-form" id="addCardForm">
                        <div class="form-group">
                            <label for="cardDeck">Select Deck</label>
                            <select id="cardDeck" required>
                                <option value="">Choose a deck...</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="cardQuestion">Question</label>
                            <textarea id="cardQuestion" placeholder="Enter your question here..." required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="cardAnswer">Answer</label>
                            <textarea id="cardAnswer" placeholder="Enter the answer here..." required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="cardTags">Tags (optional)</label>
                            <input type="text" id="cardTags" placeholder="e.g., vocabulary, math, history">
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="form-btn" id="cancelAddBtn">Cancel</button>
                            <button type="submit" class="form-btn primary">Add Card</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Spaced Repetition Info -->
            <div class="content-section">
                <div class="schedule-info">
                    <h3 class="schedule-title">How Spaced Repetition Works</h3>
                    <p style="margin-bottom: 20px; color: var(--text-secondary);">Cards are reviewed at increasing intervals based on your performance. The better you know a card, the longer you wait before reviewing it again.</p>
                    
                    <div class="schedule-grid">
                        <div class="schedule-item">
                            <div class="schedule-day">Easy</div>
                            <div class="schedule-count">Review in 4 days</div>
                        </div>
                        <div class="schedule-item">
                            <div class="schedule-day">Medium</div>
                            <div class="schedule-count">Review in 1 day</div>
                        </div>
                        <div class="schedule-item">
                            <div class="schedule-day">Hard</div>
                            <div class="schedule-count">Review in 10 minutes</div>
                        </div>
                        <div class="schedule-item">
                            <div class="schedule-day">Again</div>
                            <div class="schedule-count">Review in 1 minute</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Spaced repetition algorithm constants
        const INTERVALS = {
            easy: 4 * 24 * 60 * 60 * 1000, // 4 days
            medium: 24 * 60 * 60 * 1000,    // 1 day
            hard: 10 * 60 * 1000,           // 10 minutes
            again: 60 * 1000                 // 1 minute
        };

        // Sample data structure
        let decks = JSON.parse(localStorage.getItem('spacedRepetitionDecks')) || [
            {
                id: 1,
                name: 'Sample Vocabulary',
                description: 'Basic English vocabulary words',
                cards: [
                    {
                        id: 1,
                        question: 'What is the meaning of "ubiquitous"?',
                        answer: 'Present, appearing, or found everywhere',
                        tags: ['vocabulary', 'english'],
                        level: 0,
                        nextReview: Date.now(),
                        interval: 0,
                        reviewCount: 0,
                        correctCount: 0
                    },
                    {
                        id: 2,
                        question: 'Define "ephemeral"',
                        answer: 'Lasting for a very short time; transitory',
                        tags: ['vocabulary', 'english'],
                        level: 0,
                        nextReview: Date.now(),
                        interval: 0,
                        reviewCount: 0,
                        correctCount: 0
                    }
                ],
                created: Date.now(),
                lastStudied: null
            }
        ];

        let currentDeck = null;
        let currentCardIndex = 0;
        let studySession = {
            startTime: null,
            cardsReviewed: 0,
            correctAnswers: 0,
            streak: 0
        };

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            renderDecks();
            updateStats();
        });

        function setupEventListeners() {
            // Deck management
            document.getElementById('createDeckBtn').addEventListener('click', createNewDeck);
            document.getElementById('importDeckBtn').addEventListener('click', importDeck);
            document.getElementById('startStudyBtn').addEventListener('click', startStudySession);
            
            // Study session
            document.getElementById('showAnswerBtn').addEventListener('click', showAnswer);
            
            // Add card
            document.getElementById('addCardForm').addEventListener('submit', addNewCard);
            document.getElementById('cancelAddBtn').addEventListener('click', hideAddCardSection);
        }

        function createNewDeck() {
            const deckName = prompt('Enter deck name:');
            if (!deckName) return;
            
            const newDeck = {
                id: Date.now(),
                name: deckName,
                description: '',
                cards: [],
                created: Date.now(),
                lastStudied: null
            };
            
            decks.push(newDeck);
            saveDecks();
            renderDecks();
        }

        function importDeck() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const importedDeck = JSON.parse(e.target.result);
                        importedDeck.id = Date.now();
                        importedDeck.created = Date.now();
                        importedDeck.lastStudied = null;
                        
                        decks.push(importedDeck);
                        saveDecks();
                        renderDecks();
                        alert('Deck imported successfully!');
                    } catch (error) {
                        alert('Error importing deck. Please check the file format.');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        function startStudySession() {
            if (decks.length === 0) {
                alert('Please create a deck first.');
                return;
            }
            
            if (!currentDeck) {
                // Show deck selection
                showDeckSelection();
                return;
            }
            
            // Start studying current deck
            currentCardIndex = 0;
            studySession = {
                startTime: Date.now(),
                cardsReviewed: 0,
                correctAnswers: 0,
                streak: 0
            };
            
            showStudySection();
            showNextCard();
        }

        function showDeckSelection() {
            const deckNames = decks.map(deck => deck.name);
            const selectedDeck = prompt('Select a deck to study:\n\n' + deckNames.map((name, index) => `${index + 1}. ${name}`).join('\n'));
            
            if (!selectedDeck) return;
            
            const deckIndex = parseInt(selectedDeck) - 1;
            if (deckIndex >= 0 && deckIndex < decks.length) {
                currentDeck = decks[deckIndex];
                startStudySession();
            }
        }

        function showStudySection() {
            document.getElementById('studySection').style.display = 'block';
            document.getElementById('addCardSection').style.display = 'none';
        }

        function hideStudySection() {
            document.getElementById('studySection').style.display = 'none';
        }

        function showAddCardSection() {
            document.getElementById('addCardSection').style.display = 'block';
            document.getElementById('studySection').style.display = 'none';
            populateDeckSelect();
        }

        function hideAddCardSection() {
            document.getElementById('addCardSection').style.display = 'none';
        }

        function populateDeckSelect() {
            const select = document.getElementById('cardDeck');
            select.innerHTML = '<option value="">Choose a deck...</option>';
            
            decks.forEach(deck => {
                const option = document.createElement('option');
                option.value = deck.id;
                option.textContent = deck.name;
                select.appendChild(option);
            });
        }

        function showNextCard() {
            if (!currentDeck) return;
            
            const dueCards = currentDeck.cards.filter(card => card.nextReview <= Date.now());
            
            if (dueCards.length === 0) {
                // No cards due for review
                document.getElementById('cardQuestion').textContent = 'All caught up! No cards due for review.';
                document.getElementById('cardAnswer').style.display = 'none';
                document.getElementById('cardActions').innerHTML = `
                    <button class="card-btn primary" onclick="endStudySession()">
                        <i class="fas fa-check"></i> End Session
                    </button>
                `;
                return;
            }
            
            const card = dueCards[currentCardIndex % dueCards.length];
            document.getElementById('cardQuestion').textContent = card.question;
            document.getElementById('cardAnswer').textContent = card.answer;
            document.getElementById('cardAnswer').style.display = 'none';
            
            document.getElementById('cardActions').innerHTML = `
                <button class="card-btn show-answer" id="showAnswerBtn">
                    <i class="fas fa-eye"></i> Show Answer
                </button>
            `;
            
            document.getElementById('showAnswerBtn').addEventListener('click', showAnswer);
        }

        function showAnswer() {
            document.getElementById('cardAnswer').style.display = 'block';
            
            document.getElementById('cardActions').innerHTML = `
                <button class="card-btn difficulty easy" onclick="rateCard('easy')">
                    <i class="fas fa-smile"></i> Easy
                </button>
                <button class="card-btn difficulty medium" onclick="rateCard('medium')">
                    <i class="fas fa-meh"></i> Medium
                </button>
                <button class="card-btn difficulty hard" onclick="rateCard('hard')">
                    <i class="fas fa-frown"></i> Hard
                </button>
                <button class="card-btn difficulty again" onclick="rateCard('again')">
                    <i class="fas fa-redo"></i> Again
                </button>
            `;
        }

        function rateCard(difficulty) {
            if (!currentDeck) return;
            
            const dueCards = currentDeck.cards.filter(card => card.nextReview <= Date.now());
            const card = dueCards[currentCardIndex % dueCards.length];
            
            // Update card based on difficulty
            if (difficulty === 'easy' || difficulty === 'medium') {
                card.level++;
                card.correctCount++;
                studySession.correctAnswers++;
                studySession.streak++;
            } else {
                card.level = Math.max(0, card.level - 1);
                studySession.streak = 0;
            }
            
            // Calculate next review time
            card.interval = INTERVALS[difficulty];
            card.nextReview = Date.now() + card.interval;
            card.reviewCount++;
            
            // Update study session
            studySession.cardsReviewed++;
            currentCardIndex++;
            
            // Update display
            updateStudyStats();
            
            // Show next card or end session
            if (currentCardIndex < dueCards.length) {
                showNextCard();
            } else {
                endStudySession();
            }
        }

        function endStudySession() {
            if (studySession.startTime) {
                currentDeck.lastStudied = Date.now();
                saveDecks();
            }
            
            hideStudySection();
            renderDecks();
            updateStats();
            
            // Show session summary
            const timeSpent = Math.round((Date.now() - studySession.startTime) / 60000);
            const accuracy = studySession.cardsReviewed > 0 ? Math.round((studySession.correctAnswers / studySession.cardsReviewed) * 100) : 0;
            
            alert(`Study session completed!\n\nCards reviewed: ${studySession.cardsReviewed}\nAccuracy: ${accuracy}%\nTime spent: ${timeSpent} minutes\nStreak: ${studySession.streak}`);
        }

        function addNewCard(event) {
            event.preventDefault();
            
            const deckId = parseInt(document.getElementById('cardDeck').value);
            const question = document.getElementById('cardQuestion').value;
            const answer = document.getElementById('cardAnswer').value;
            const tags = document.getElementById('cardTags').value;
            
            if (!deckId || !question || !answer) {
                alert('Please fill in all required fields.');
                return;
            }
            
            const deck = decks.find(d => d.id === deckId);
            if (!deck) return;
            
            const newCard = {
                id: Date.now(),
                question: question,
                answer: answer,
                tags: tags ? tags.split(',').map(tag => tag.trim()) : [],
                level: 0,
                nextReview: Date.now(),
                interval: 0,
                reviewCount: 0,
                correctCount: 0
            };
            
            deck.cards.push(newCard);
            saveDecks();
            renderDecks();
            
            // Reset form
            document.getElementById('addCardForm').reset();
            hideAddCardSection();
            
            alert('Card added successfully!');
        }

        function renderDecks() {
            const deckGrid = document.getElementById('deckGrid');
            deckGrid.innerHTML = '';
            
            if (decks.length === 0) {
                deckGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--text-secondary);">
                        <i class="fas fa-folder-open" style="font-size: 3rem; margin-bottom: 20px; display: block;"></i>
                        <h3>No decks yet</h3>
                        <p>Create your first deck to start learning!</p>
                    </div>
                `;
                return;
            }
            
            decks.forEach(deck => {
                const deckCard = document.createElement('div');
                deckCard.className = 'deck-card';
                deckCard.onclick = () => selectDeck(deck);
                
                const totalCards = deck.cards.length;
                const dueCards = deck.cards.filter(card => card.nextReview <= Date.now()).length;
                const progress = totalCards > 0 ? ((totalCards - dueCards) / totalCards) * 100 : 0;
                
                deckCard.innerHTML = `
                    <div class="deck-name">${deck.name}</div>
                    <div class="deck-stats">
                        <span>${totalCards} cards</span>
                        <span>${dueCards} due</span>
                    </div>
                    <div class="deck-progress">
                        <div class="deck-progress-bar" style="width: ${progress}%"></div>
                    </div>
                    <div class="deck-actions">
                        <button class="deck-action-btn" onclick="event.stopPropagation(); addCardToDeck(${deck.id})">
                            <i class="fas fa-plus"></i> Add Card
                        </button>
                        <button class="deck-action-btn" onclick="event.stopPropagation(); exportDeck(${deck.id})">
                            <i class="fas fa-download"></i> Export
                        </button>
                        <button class="deck-action-btn" onclick="event.stopPropagation(); deleteDeck(${deck.id})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                
                deckGrid.appendChild(deckCard);
            });
        }

        function selectDeck(deck) {
            currentDeck = deck;
            startStudySession();
        }

        function addCardToDeck(deckId) {
            currentDeck = decks.find(d => d.id === deckId);
            showAddCardSection();
        }

        function exportDeck(deckId) {
            const deck = decks.find(d => d.id === deckId);
            if (!deck) return;
            
            const dataStr = JSON.stringify(deck, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${deck.name.replace(/[^a-z0-9]/gi, '_').toLowerCase()}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        function deleteDeck(deckId) {
            if (!confirm('Are you sure you want to delete this deck? This action cannot be undone.')) return;
            
            decks = decks.filter(d => d.id !== deckId);
            if (currentDeck && currentDeck.id === deckId) {
                currentDeck = null;
            }
            
            saveDecks();
            renderDecks();
        }

        function updateStudyStats() {
            document.getElementById('cardsReviewed').textContent = studySession.cardsReviewed;
            document.getElementById('sessionStreak').textContent = studySession.streak;
            
            const accuracy = studySession.cardsReviewed > 0 ? Math.round((studySession.correctAnswers / studySession.cardsReviewed) * 100) : 0;
            document.getElementById('accuracyRate').textContent = accuracy + '%';
            
            if (studySession.startTime) {
                const timeSpent = Math.round((Date.now() - studySession.startTime) / 60000);
                document.getElementById('timeSpent').textContent = timeSpent + 'm';
            }
        }

        function updateStats() {
            // Update overall statistics
            const totalCards = decks.reduce((sum, deck) => sum + deck.cards.length, 0);
            const totalDue = decks.reduce((sum, deck) => sum + deck.cards.filter(card => card.nextReview <= Date.now()).length, 0);
            
            // You can add more stats here as needed
        }

        function saveDecks() {
            localStorage.setItem('spacedRepetitionDecks', JSON.stringify(decks));
        }
    </script>
</body>
</html>
