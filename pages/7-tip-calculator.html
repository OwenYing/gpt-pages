<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tip Calculator - GPT Ideas Hub</title>
    <link rel="stylesheet" href="../styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .page-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        .page-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 0;
            background: var(--gradient-primary);
            color: white;
            border-radius: var(--border-radius);
            position: relative;
            overflow: hidden;
        }
        
        .page-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="50" cy="10" r="0.5" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.3;
        }
        
        .page-header-content {
            position: relative;
            z-index: 2;
        }
        
        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 16px;
            font-family: 'Space Grotesk', sans-serif;
        }
        
        .page-meta {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .page-category-badge {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .page-number-badge {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--primary-color);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: var(--border-radius);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .back-button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .content-section {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: var(--shadow-md);
        }
        
        .content-section h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-family: 'Space Grotesk', sans-serif;
        }
        
        .content-section p {
            line-height: 1.8;
            margin-bottom: 16px;
            color: var(--text-secondary);
        }
        
        .calculator-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 20px 0;
        }
        
        .calculator-input {
            background: var(--bg-tertiary);
            padding: 25px;
            border-radius: var(--border-radius);
            border: 2px solid var(--border-color);
        }
        
        .calculator-input h3 {
            margin-bottom: 20px;
            color: var(--primary-color);
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-family: inherit;
            font-size: 1rem;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .tip-percentages {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .tip-option {
            background: white;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }
        
        .tip-option:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }
        
        .tip-option.selected {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .tip-option .percentage {
            font-size: 1.2rem;
            font-weight: 700;
        }
        
        .tip-option .label {
            font-size: 0.9rem;
            margin-top: 5px;
            opacity: 0.8;
        }
        
        .custom-tip {
            margin-top: 15px;
        }
        
        .custom-tip input {
            text-align: center;
            font-weight: 600;
        }
        
        .split-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .split-option {
            background: white;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }
        
        .split-option:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }
        
        .split-option.selected {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .split-option .number {
            font-size: 1.2rem;
            font-weight: 700;
        }
        
        .split-option .label {
            font-size: 0.8rem;
            margin-top: 5px;
            opacity: 0.8;
        }
        
        .custom-split {
            margin-top: 15px;
        }
        
        .custom-split input {
            text-align: center;
            font-weight: 600;
        }
        
        .results-display {
            background: var(--bg-tertiary);
            padding: 25px;
            border-radius: var(--border-radius);
            border: 2px solid var(--border-color);
        }
        
        .results-display h3 {
            margin-bottom: 20px;
            color: var(--primary-color);
            text-align: center;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-label {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .result-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .total-amount {
            background: var(--primary-color);
            color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            text-align: center;
            margin-top: 20px;
        }
        
        .total-amount .label {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .total-amount .amount {
            font-size: 2rem;
            font-weight: 700;
        }
        
        .per-person {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin: 5px;
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 2px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        .btn-success {
            background: var(--success-color);
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .calculator-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        .tip-tips {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
            border-left: 4px solid var(--primary-color);
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
        }
        
        .tip-tips h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .tip-tips ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .tip-tips li {
            margin-bottom: 8px;
            line-height: 1.6;
        }
        
        .tip-history {
            margin-top: 20px;
        }
        
        .history-item {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            margin-bottom: 15px;
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .history-date {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .history-total {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .history-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .history-detail {
            text-align: center;
        }
        
        .history-detail .label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }
        
        .history-detail .value {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .preset-scenarios {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .scenario-card {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            border: 2px solid var(--border-color);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .scenario-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .scenario-icon {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .scenario-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 10px;
        }
        
        .scenario-tip {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 8px;
        }
        
        .scenario-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .export-section {
            background: var(--bg-tertiary);
            padding: 20px;
            border-radius: var(--border-radius);
            border: 2px dashed var(--border-color);
            text-align: center;
            margin: 20px 0;
        }
        
        .export-section h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .export-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        @media (max-width: 768px) {
            .calculator-container {
                grid-template-columns: 1fr;
            }
            
            .page-title {
                font-size: 2rem;
            }
            
            .back-button {
                position: relative;
                top: auto;
                left: auto;
                margin-bottom: 20px;
                display: inline-flex;
            }
            
            .tip-percentages {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .split-options {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .preset-scenarios {
                grid-template-columns: 1fr;
            }
            
            .calculator-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .export-buttons {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body class="individual-page">
    <a href="../index.html" class="back-button">
        <i class="fas fa-arrow-left"></i> Back to Hub
    </a>
    
    <div class="container">
        <div class="page-content">
            <!-- Page Header -->
            <div class="page-header">
                <div class="page-header-content">
                    <h1 class="page-title">Tip Calculator</h1>
                    <div class="page-meta">
                        <span class="page-category-badge">Personal Tools</span>
                        <span class="page-number-badge">Page #7</span>
                    </div>
                </div>
            </div>
            
            <!-- Introduction -->
            <div class="content-section">
                <h2>About Tip Calculation</h2>
                <p>
                    Calculate tips quickly and accurately for restaurants, services, and other situations where tipping is expected. 
                    This tool helps you determine the appropriate tip amount based on service quality and split bills among multiple people.
                </p>
                
                <div class="tip-tips">
                    <h3>Tip Etiquette Guide</h3>
                    <ul>
                        <li><strong>15%:</strong> Standard service - good but not exceptional</li>
                        <li><strong>18%:</strong> Good service - attentive and friendly</li>
                        <li><strong>20%:</strong> Excellent service - outstanding experience</li>
                        <li><strong>25%:</strong> Exceptional service - went above and beyond</li>
                        <li><strong>10%:</strong> Poor service - only if service was truly bad</li>
                        <li><strong>0%:</strong> No tip - only for extremely poor service</li>
                    </ul>
                </div>
            </div>
            
            <!-- Tip Calculator -->
            <div class="content-section">
                <h2>Calculate Your Tip</h2>
                <p>Enter your bill amount, select tip percentage, and choose how many people to split with.</p>
                
                <div class="calculator-container">
                    <div class="calculator-input">
                        <h3>Bill & Tip Settings</h3>
                        
                        <div class="input-group">
                            <label for="billAmount">Bill Amount ($)</label>
                            <input type="number" id="billAmount" placeholder="0.00" step="0.01" min="0">
                        </div>
                        
                        <div class="input-group">
                            <label>Tip Percentage</label>
                            <div class="tip-percentages">
                                <div class="tip-option" onclick="selectTip(10)">
                                    <div class="percentage">10%</div>
                                    <div class="label">Poor</div>
                                </div>
                                <div class="tip-option" onclick="selectTip(15)">
                                    <div class="percentage">15%</div>
                                    <div class="label">Standard</div>
                                </div>
                                <div class="tip-option" onclick="selectTip(18)">
                                    <div class="percentage">18%</div>
                                    <div class="label">Good</div>
                                </div>
                                <div class="tip-option" onclick="selectTip(20)">
                                    <div class="percentage">20%</div>
                                    <div class="label">Excellent</div>
                                </div>
                                <div class="tip-option" onclick="selectTip(25)">
                                    <div class="percentage">25%</div>
                                    <div class="label">Exceptional</div>
                                </div>
                                <div class="tip-option" onclick="selectTip(0)">
                                    <div class="percentage">0%</div>
                                    <div class="label">No Tip</div>
                                </div>
                            </div>
                            <div class="custom-tip">
                                <input type="number" id="customTip" placeholder="Custom %" step="0.1" min="0" max="100">
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <label>Split Bill</label>
                            <div class="split-options">
                                <div class="split-option" onclick="selectSplit(1)">
                                    <div class="number">1</div>
                                    <div class="label">Person</div>
                                </div>
                                <div class="split-option" onclick="selectSplit(2)">
                                    <div class="number">2</div>
                                    <div class="label">People</div>
                                </div>
                                <div class="split-option" onclick="selectSplit(3)">
                                    <div class="number">3</div>
                                    <div class="label">People</div>
                                </div>
                                <div class="split-option" onclick="selectSplit(4)">
                                    <div class="number">4</div>
                                    <div class="label">People</div>
                                </div>
                                <div class="split-option" onclick="selectSplit(5)">
                                    <div class="number">5</div>
                                    <div class="label">People</div>
                                </div>
                                <div class="split-option" onclick="selectSplit(6)">
                                    <div class="number">6</div>
                                    <div class="label">People</div>
                                </div>
                            </div>
                            <div class="custom-split">
                                <input type="number" id="customSplit" placeholder="Custom #" min="1" max="20">
                            </div>
                        </div>
                        
                        <div class="calculator-controls">
                            <button class="btn btn-primary" onclick="calculateTip()">
                                <i class="fas fa-calculator"></i> Calculate Tip
                            </button>
                            <button class="btn btn-secondary" onclick="resetCalculator()">
                                <i class="fas fa-undo"></i> Reset
                            </button>
                            <button class="btn btn-success" onclick="saveCalculation()">
                                <i class="fas fa-save"></i> Save Result
                            </button>
                        </div>
                    </div>
                    
                    <div class="results-display">
                        <h3>Tip Breakdown</h3>
                        
                        <div class="result-item">
                            <span class="result-label">Bill Amount:</span>
                            <span class="result-value" id="displayBill">$0.00</span>
                        </div>
                        
                        <div class="result-item">
                            <span class="result-label">Tip Percentage:</span>
                            <span class="result-value" id="displayTipPercent">0%</span>
                        </div>
                        
                        <div class="result-item">
                            <span class="result-label">Tip Amount:</span>
                            <span class="result-value" id="displayTipAmount">$0.00</span>
                        </div>
                        
                        <div class="result-item">
                            <span class="result-label">Subtotal:</span>
                            <span class="result-value" id="displaySubtotal">$0.00</span>
                        </div>
                        
                        <div class="result-item">
                            <span class="result-label">Tax (Est. 8.5%):</span>
                            <span class="result-value" id="displayTax">$0.00</span>
                        </div>
                        
                        <div class="result-item">
                            <span class="result-label">People Splitting:</span>
                            <span class="result-value" id="displaySplit">1</span>
                        </div>
                        
                        <div class="total-amount">
                            <div class="label">Total Amount</div>
                            <div class="amount" id="displayTotal">$0.00</div>
                            <div class="per-person" id="displayPerPerson">$0.00 per person</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Preset Scenarios -->
            <div class="content-section">
                <h2>Common Tip Scenarios</h2>
                <p>Quick access to common tipping situations. Click any scenario to automatically set the appropriate tip percentage.</p>
                
                <div class="preset-scenarios">
                    <div class="scenario-card" onclick="setScenario(15, 'Restaurant')">
                        <div class="scenario-icon">🍽️</div>
                        <div class="scenario-title">Restaurant Dining</div>
                        <div class="scenario-tip">15%</div>
                        <div class="scenario-description">Standard sit-down restaurant service</div>
                    </div>
                    
                    <div class="scenario-card" onclick="setScenario(20, 'Fine Dining')">
                        <div class="scenario-icon">🍷</div>
                        <div class="scenario-title">Fine Dining</div>
                        <div class="scenario-tip">20%</div>
                        <div class="scenario-description">Upscale restaurants with exceptional service</div>
                    </div>
                    
                    <div class="scenario-card" onclick="setScenario(18, 'Delivery')">
                        <div class="scenario-icon">🚚</div>
                        <div class="scenario-title">Food Delivery</div>
                        <div class="scenario-tip">18%</div>
                        <div class="scenario-description">Food delivery services and takeout</div>
                    </div>
                    
                    <div class="scenario-card" onclick="setScenario(20, 'Hair Salon')">
                        <div class="scenario-icon">💇‍♀️</div>
                        <div class="scenario-title">Hair Salon</div>
                        <div class="scenario-tip">20%</div>
                        <div class="scenario-description">Haircuts, styling, and salon services</div>
                    </div>
                    
                    <div class="scenario-card" onclick="setScenario(15, 'Taxi')">
                        <div class="scenario-icon">🚕</div>
                        <div class="scenario-title">Taxi/Rideshare</div>
                        <div class="scenario-tip">15%</div>
                        <div class="scenario-description">Taxi rides and rideshare services</div>
                    </div>
                    
                    <div class="scenario-card" onclick="setScenario(20, 'Hotel')">
                        <div class="scenario-icon">🏨</div>
                        <div class="scenario-title">Hotel Service</div>
                        <div class="scenario-tip">20%</div>
                        <div class="scenario-description">Bellhop, room service, and hotel staff</div>
                    </div>
                </div>
            </div>
            
            <!-- Tip History -->
            <div class="content-section">
                <h2>Your Tip History</h2>
                <p>Review your previous tip calculations for reference and tracking.</p>
                
                <div id="tipHistory" class="tip-history">
                    <p style="text-align: center; color: var(--text-muted); padding: 40px;">
                        <i class="fas fa-receipt" style="font-size: 3rem; margin-bottom: 15px; display: block; color: var(--border-color);"></i>
                        No tip calculations yet.<br>
                        Calculate a tip to see your history here.
                    </p>
                </div>
            </div>
            
            <!-- Export Section -->
            <div class="export-section">
                <h3>Export Your Tip Calculation</h3>
                <p>Save your tip calculation results for future reference or sharing.</p>
                
                <div class="export-buttons">
                    <button class="btn btn-success" onclick="exportToCSV()">
                        <i class="fas fa-download"></i> Export to CSV
                    </button>
                    <button class="btn btn-secondary" onclick="exportToJSON()">
                        <i class="fas fa-code"></i> Export to JSON
                    </button>
                    <button class="btn btn-secondary" onclick="clearHistory()">
                        <i class="fas fa-trash"></i> Clear History
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Tip calculator state
        let selectedTipPercent = 18;
        let selectedSplit = 1;
        let currentCalculation = null;
        let tipHistory = JSON.parse(localStorage.getItem('tipHistory')) || [];
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Set default selections
            selectTip(18);
            selectSplit(1);
            loadTipHistory();
        });
        
        // Select tip percentage
        function selectTip(percent) {
            selectedTipPercent = percent;
            
            // Update visual selection
            document.querySelectorAll('.tip-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Find and select the clicked option
            const tipOptions = document.querySelectorAll('.tip-option');
            tipOptions.forEach((option, index) => {
                const percentages = [10, 15, 18, 20, 25, 0];
                if (percentages[index] === percent) {
                    option.classList.add('selected');
                }
            });
            
            // Clear custom tip input
            document.getElementById('customTip').value = '';
            
            // Recalculate if bill amount exists
            if (document.getElementById('billAmount').value) {
                calculateTip();
            }
        }
        
        // Select split number
        function selectSplit(number) {
            selectedSplit = number;
            
            // Update visual selection
            document.querySelectorAll('.split-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Find and select the clicked option
            const splitOptions = document.querySelectorAll('.split-option');
            splitOptions.forEach((option, index) => {
                const numbers = [1, 2, 3, 4, 5, 6];
                if (numbers[index] === number) {
                    option.classList.add('selected');
                }
            });
            
            // Clear custom split input
            document.getElementById('customSplit').value = '';
            
            // Recalculate if bill amount exists
            if (document.getElementById('billAmount').value) {
                calculateTip();
            }
        }
        
        // Set scenario
        function setScenario(tipPercent, scenario) {
            selectTip(tipPercent);
            document.getElementById('billAmount').focus();
            
            // Show a brief message
            const message = `Set to ${scenario} scenario (${tipPercent}% tip)`;
            showMessage(message);
        }
        
        // Show message
        function showMessage(message) {
            // Create a temporary message element
            const messageEl = document.createElement('div');
            messageEl.textContent = message;
            messageEl.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--primary-color);
                color: white;
                padding: 15px 20px;
                border-radius: var(--border-radius);
                z-index: 1000;
                animation: slideIn 0.3s ease-out;
            `;
            
            document.body.appendChild(messageEl);
            
            // Remove after 3 seconds
            setTimeout(() => {
                messageEl.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    document.body.removeChild(messageEl);
                }, 300);
            }, 3000);
        }
        
        // Calculate tip
        function calculateTip() {
            const billAmount = parseFloat(document.getElementById('billAmount').value) || 0;
            
            if (billAmount <= 0) {
                alert('Please enter a valid bill amount.');
                return;
            }
            
            // Check for custom tip percentage
            const customTip = parseFloat(document.getElementById('customTip').value);
            if (customTip !== 0 && !isNaN(customTip)) {
                selectedTipPercent = customTip;
            }
            
            // Check for custom split
            const customSplit = parseInt(document.getElementById('customSplit').value);
            if (customSplit > 0 && !isNaN(customSplit)) {
                selectedSplit = customSplit;
            }
            
            // Calculate tip amount
            const tipAmount = (billAmount * selectedTipPercent) / 100;
            const subtotal = billAmount + tipAmount;
            
            // Estimate tax (8.5% is common in many areas)
            const estimatedTax = billAmount * 0.085;
            const total = subtotal + estimatedTax;
            
            // Calculate per person
            const perPerson = total / selectedSplit;
            
            // Store calculation
            currentCalculation = {
                billAmount: billAmount,
                tipPercent: selectedTipPercent,
                tipAmount: tipAmount,
                subtotal: subtotal,
                estimatedTax: estimatedTax,
                total: total,
                split: selectedSplit,
                perPerson: perPerson,
                calculatedAt: new Date().toISOString()
            };
            
            // Update display
            updateDisplay();
        }
        
        // Update display
        function updateDisplay() {
            if (!currentCalculation) return;
            
            document.getElementById('displayBill').textContent = `$${currentCalculation.billAmount.toFixed(2)}`;
            document.getElementById('displayTipPercent').textContent = `${currentCalculation.tipPercent}%`;
            document.getElementById('displayTipAmount').textContent = `$${currentCalculation.tipAmount.toFixed(2)}`;
            document.getElementById('displaySubtotal').textContent = `$${currentCalculation.subtotal.toFixed(2)}`;
            document.getElementById('displayTax').textContent = `$${currentCalculation.estimatedTax.toFixed(2)}`;
            document.getElementById('displaySplit').textContent = currentCalculation.split;
            document.getElementById('displayTotal').textContent = `$${currentCalculation.total.toFixed(2)}`;
            document.getElementById('displayPerPerson').textContent = `$${currentCalculation.perPerson.toFixed(2)} per person`;
        }
        
        // Reset calculator
        function resetCalculator() {
            document.getElementById('billAmount').value = '';
            document.getElementById('customTip').value = '';
            document.getElementById('customSplit').value = '';
            
            // Reset selections
            selectTip(18);
            selectSplit(1);
            
            // Clear display
            currentCalculation = null;
            updateDisplay();
            
            // Reset display values
            document.getElementById('displayBill').textContent = '$0.00';
            document.getElementById('displayTipPercent').textContent = '0%';
            document.getElementById('displayTipAmount').textContent = '$0.00';
            document.getElementById('displaySubtotal').textContent = '$0.00';
            document.getElementById('displayTax').textContent = '$0.00';
            document.getElementById('displaySplit').textContent = '1';
            document.getElementById('displayTotal').textContent = '$0.00';
            document.getElementById('displayPerPerson').textContent = '$0.00 per person';
        }
        
        // Save calculation
        function saveCalculation() {
            if (!currentCalculation) {
                alert('Please calculate a tip first.');
                return;
            }
            
            const calculation = {
                ...currentCalculation,
                id: Date.now()
            };
            
            tipHistory.push(calculation);
            localStorage.setItem('tipHistory', JSON.stringify(tipHistory));
            loadTipHistory();
            
            alert('Tip calculation saved successfully!');
        }
        
        // Load tip history
        function loadTipHistory() {
            const container = document.getElementById('tipHistory');
            
            if (tipHistory.length === 0) {
                container.innerHTML = `
                    <p style="text-align: center; color: var(--text-muted); padding: 40px;">
                        <i class="fas fa-receipt" style="font-size: 3rem; margin-bottom: 15px; display: block; color: var(--border-color);"></i>
                        No tip calculations yet.<br>
                        Calculate a tip to see your history here.
                    </p>
                `;
                return;
            }
            
            // Sort by date (newest first)
            const sortedHistory = [...tipHistory].sort((a, b) => new Date(b.calculatedAt) - new Date(a.calculatedAt));
            
            let historyHTML = '';
            sortedHistory.forEach(calculation => {
                const date = new Date(calculation.calculatedAt).toLocaleDateString();
                historyHTML += `
                    <div class="history-item">
                        <div class="history-header">
                            <div class="history-date">${date}</div>
                            <div class="history-total">$${calculation.total.toFixed(2)}</div>
                        </div>
                        <div class="history-details">
                            <div class="history-detail">
                                <div class="label">Bill</div>
                                <div class="value">$${calculation.billAmount.toFixed(2)}</div>
                            </div>
                            <div class="history-detail">
                                <div class="label">Tip</div>
                                <div class="value">${calculation.tipPercent}%</div>
                            </div>
                            <div class="history-detail">
                                <div class="label">Tip Amount</div>
                                <div class="value">$${calculation.tipAmount.toFixed(2)}</div>
                            </div>
                            <div class="history-detail">
                                <div class="label">Split</div>
                                <div class="value">${calculation.split} person${calculation.split > 1 ? 's' : ''}</div>
                            </div>
                            <div class="history-detail">
                                <div class="label">Per Person</div>
                                <div class="value">$${calculation.perPerson.toFixed(2)}</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = historyHTML;
        }
        
        // Export to CSV
        function exportToCSV() {
            if (tipHistory.length === 0) {
                alert('No tip calculations to export.');
                return;
            }
            
            const headers = ['Date', 'Bill Amount', 'Tip %', 'Tip Amount', 'Subtotal', 'Estimated Tax', 'Total', 'Split', 'Per Person'];
            const csvContent = [
                headers.join(','),
                ...tipHistory.map(calc => [
                    new Date(calc.calculatedAt).toLocaleDateString(),
                    calc.billAmount.toFixed(2),
                    calc.tipPercent,
                    calc.tipAmount.toFixed(2),
                    calc.subtotal.toFixed(2),
                    calc.estimatedTax.toFixed(2),
                    calc.total.toFixed(2),
                    calc.split,
                    calc.perPerson.toFixed(2)
                ].join(','))
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `tip-calculations-${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // Export to JSON
        function exportToJSON() {
            if (tipHistory.length === 0) {
                alert('No tip calculations to export.');
                return;
            }
            
            const dataStr = JSON.stringify(tipHistory, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `tip-calculations-${new Date().toISOString().split('T')[0]}.json`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // Clear history
        function clearHistory() {
            if (confirm('Are you sure you want to clear all tip calculation history? This action cannot be undone.')) {
                tipHistory = [];
                localStorage.removeItem('tipHistory');
                loadTipHistory();
                alert('Tip history has been cleared.');
            }
        }
        
        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
