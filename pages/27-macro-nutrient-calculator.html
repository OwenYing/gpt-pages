<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Macro Nutrient Calculator - GPT Ideas Hub</title>
    <link rel="stylesheet" href="../styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .page-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        .page-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 0;
            background: var(--gradient-primary);
            color: white;
            border-radius: var(--border-radius);
            position: relative;
            overflow: hidden;
        }
        
        .page-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="50" cy="10" r="0.5" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.3;
        }
        
        .page-header-content {
            position: relative;
            z-index: 2;
        }
        
        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 16px;
            font-family: 'Space Grotesk', sans-serif;
        }
        
        .page-meta {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .page-category-badge {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .page-number-badge {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--primary-color);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: var(--border-radius);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .back-button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .content-section {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: var(--shadow-md);
        }
        
        .content-section h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-family: 'Space Grotesk', sans-serif;
        }
        
        .content-section p {
            line-height: 1.8;
            margin-bottom: 16px;
            color: var(--text-secondary);
        }
        
        .macro-tips {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
            border-left: 4px solid var(--primary-color);
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
        }
        
        .macro-tips h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .macro-tips ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .macro-tips li {
            margin-bottom: 8px;
            line-height: 1.6;
        }
        
        .calculator-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 20px 0;
        }
        
        .calculator-input {
            background: var(--bg-tertiary);
            padding: 25px;
            border-radius: var(--border-radius);
            border: 2px solid var(--border-color);
        }
        
        .calculator-input h3 {
            margin-bottom: 20px;
            color: var(--primary-color);
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-family: inherit;
            font-size: 1rem;
        }
        
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .calculator-result {
            background: var(--bg-tertiary);
            padding: 25px;
            border-radius: var(--border-radius);
            border: 2px solid var(--border-color);
        }
        
        .calculator-result h3 {
            margin-bottom: 20px;
            color: var(--primary-color);
            text-align: center;
        }
        
        .macro-summary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 30px;
            border-radius: var(--border-radius);
            text-align: center;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .macro-summary::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="nutrition" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="50" cy="10" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23nutrition)"/></svg>');
            opacity: 0.3;
        }
        
        .macro-summary-content {
            position: relative;
            z-index: 2;
        }
        
        .macro-summary .label {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .macro-summary .amount {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .macro-summary .breakdown {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin: 5px;
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 2px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        .btn-success {
            background: var(--success-color);
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .calculator-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        .macro-breakdown {
            margin: 20px 0;
        }
        
        .macro-item {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            border: 2px solid var(--border-color);
            margin-bottom: 15px;
            transition: var(--transition);
        }
        
        .macro-item:hover {
            border-color: var(--primary-color);
            box-shadow: var(--shadow-md);
        }
        
        .macro-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .macro-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1.1rem;
        }
        
        .macro-amount {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .macro-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .detail-item {
            text-align: center;
        }
        
        .detail-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }
        
        .detail-value {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .macro-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.5;
            font-style: italic;
        }
        
        .macro-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: var(--bg-tertiary);
            padding: 25px;
            border-radius: var(--border-radius);
            border: 2px solid var(--border-color);
            text-align: center;
            transition: var(--transition);
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .stat-icon {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 8px;
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .macro-chart {
            margin: 20px 0;
        }
        
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            border: 2px solid var(--border-color);
            margin: 20px 0;
        }
        
        .macro-bars {
            display: flex;
            gap: 10px;
            align-items: end;
            height: 200px;
            margin: 20px 0;
        }
        
        .macro-bar {
            flex: 1;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            position: relative;
            min-height: 20px;
            transition: height 0.5s ease;
        }
        
        .macro-bar.protein { background: #ef4444; }
        .macro-bar.carbs { background: #3b82f6; }
        .macro-bar.fats { background: #f59e0b; }
        
        .macro-label {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            text-align: center;
        }
        
        .macro-value {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .preset-profiles {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .profile-card {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            border: 2px solid var(--border-color);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .profile-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .profile-icon {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .profile-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 10px;
        }
        
        .profile-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .nutrition-recommendations {
            margin: 20px 0;
        }
        
        .recommendation-card {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            border: 2px solid var(--border-color);
            margin-bottom: 15px;
            transition: var(--transition);
        }
        
        .recommendation-card:hover {
            border-color: var(--primary-color);
            box-shadow: var(--shadow-md);
        }
        
        .recommendation-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .recommendation-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }
        
        .recommendation-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1.1rem;
        }
        
        .recommendation-description {
            color: var(--text-secondary);
            line-height: 1.6;
        }
        
        @media (max-width: 768px) {
            .calculator-container {
                grid-template-columns: 1fr;
            }
            
            .page-title {
                font-size: 2rem;
            }
            
            .back-button {
                position: relative;
                top: auto;
                left: auto;
                margin-bottom: 20px;
                display: inline-flex;
            }
            
            .input-row {
                grid-template-columns: 1fr;
            }
            
            .preset-profiles {
                grid-template-columns: 1fr;
            }
            
            .calculator-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .macro-details {
                grid-template-columns: 1fr;
            }
            
            .macro-bars {
                flex-direction: column;
                height: auto;
                gap: 20px;
            }
            
            .macro-bar {
                height: 60px;
            }
        }
    </style>
</head>
<body>
    <a href="../index.html" class="back-button">
        <i class="fas fa-arrow-left"></i> Back to Hub
    </a>
    
    <div class="container">
        <div class="page-content">
            <!-- Page Header -->
            <div class="page-header">
                <div class="page-header-content">
                    <h1 class="page-title">Macro Nutrient Calculator</h1>
                    <div class="page-meta">
                        <span class="page-category-badge">Health & Fitness</span>
                        <span class="page-number-badge">Page #27</span>
                    </div>
                </div>
            </div>
            
            <!-- Introduction -->
            <div class="content-section">
                <h2>About Macro Nutrients</h2>
                <p>
                    Calculate your daily macro nutrient needs based on your goals, activity level, and body composition. 
                    Understanding macros helps you fuel your body properly for optimal performance and health.
                </p>
                
                <div class="macro-tips">
                    <h3>Macro Nutrient Tips</h3>
                    <ul>
                        <li><strong>Protein:</strong> Essential for muscle repair and growth (0.8-2.2g per kg body weight)</li>
                        <li><strong>Carbohydrates:</strong> Primary fuel source for energy and performance</li>
                        <li><strong>Fats:</strong> Important for hormone production and nutrient absorption</li>
                        <li><strong>Timing:</strong> Protein around workouts, carbs before/during, fats away from training</li>
                        <li><strong>Quality:</strong> Choose whole foods over processed options</li>
                        <li><strong>Hydration:</strong> Drink water throughout the day, especially during exercise</li>
                    </ul>
                </div>
            </div>
            
            <!-- Macro Nutrient Calculator -->
            <div class="content-section">
                <h2>Calculate Your Macro Needs</h2>
                <p>Enter your information to determine your personalized macro nutrient requirements.</p>
                
                <div class="calculator-container">
                    <div class="calculator-input">
                        <h3>Personal Information</h3>
                        
                        <div class="input-group">
                            <label for="age">Age</label>
                            <input type="number" id="age" placeholder="30" min="15" max="100" step="1">
                        </div>
                        
                        <div class="input-group">
                            <label for="gender">Gender</label>
                            <select id="gender">
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label for="weight">Weight (kg)</label>
                            <input type="number" id="weight" placeholder="70" min="30" max="300" step="0.1">
                        </div>
                        
                        <div class="input-group">
                            <label for="height">Height (cm)</label>
                            <input type="number" id="height" placeholder="170" min="100" max="250" step="1">
                        </div>
                        
                        <div class="input-group">
                            <label for="activityLevel">Activity Level</label>
                            <select id="activityLevel">
                                <option value="sedentary">Sedentary (Little to no exercise)</option>
                                <option value="light">Light (1-3 days/week)</option>
                                <option value="moderate" selected>Moderate (3-5 days/week)</option>
                                <option value="active">Active (6-7 days/week)</option>
                                <option value="very_active">Very Active (Athlete/Physical job)</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label for="goal">Goal</label>
                            <select id="goal">
                                <option value="lose">Lose Weight</option>
                                <option value="maintain" selected>Maintain Weight</option>
                                <option value="gain">Gain Weight</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label for="bodyFat">Body Fat % (Optional)</label>
                            <input type="number" id="bodyFat" placeholder="20" min="5" max="50" step="1">
                        </div>
                        
                        <div class="calculator-controls">
                            <button class="btn btn-primary" onclick="calculateMacros()">
                                <i class="fas fa-calculator"></i> Calculate Macros
                            </button>
                            <button class="btn btn-secondary" onclick="resetCalculator()">
                                <i class="fas fa-undo"></i> Reset
                            </button>
                            <button class="btn btn-success" onclick="saveCalculation()">
                                <i class="fas fa-save"></i> Save
                            </button>
                        </div>
                    </div>
                    
                    <div class="calculator-result">
                        <h3>Macro Breakdown</h3>
                        
                        <div class="macro-summary">
                            <div class="macro-summary-content">
                                <div class="label">Daily Calories</div>
                                <div class="amount" id="displayCalories">2,100</div>
                                <div class="breakdown" id="displayBreakdown">Based on your inputs</div>
                            </div>
                        </div>
                        
                        <div class="macro-breakdown" id="macroBreakdown">
                            <!-- Macro breakdown will be generated here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Statistics -->
            <div class="content-section">
                <h2>Nutrition Summary</h2>
                <p>Key metrics to understand your macro nutrient needs.</p>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üî•</div>
                        <div class="stat-value" id="statCalories">2,100</div>
                        <div class="stat-label">Daily Calories</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">üí™</div>
                        <div class="stat-value" id="statProtein">140</div>
                        <div class="stat-label">Protein (g)</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">üçû</div>
                        <div class="stat-value" id="statCarbs">210</div>
                        <div class="stat-label">Carbs (g)</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">ü•ë</div>
                        <div class="stat-value" id="statFats">70</div>
                        <div class="stat-label">Fats (g)</div>
                    </div>
                </div>
            </div>
            
            <!-- Macro Chart -->
            <div class="content-section">
                <h2>Macro Distribution</h2>
                <p>Visual representation of your macro nutrient breakdown.</p>
                
                <div class="macro-chart">
                    <div class="chart-container">
                        <div class="macro-bars" id="macroChart">
                            <!-- Macro bars will be generated here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Nutrition Recommendations -->
            <div class="content-section">
                <h2>Nutrition Recommendations</h2>
                <p>Personalized advice for meeting your macro nutrient goals.</p>
                
                <div class="nutrition-recommendations" id="nutritionRecommendations">
                    <!-- Recommendations will be generated here -->
                </div>
            </div>
            
            <!-- Preset Profiles -->
            <div class="content-section">
                <h2>Quick Start Profiles</h2>
                <p>Click any profile to quickly set common macro nutrient parameters.</p>
        
                <div class="preset-profiles">
                    <div class="profile-card" onclick="setProfile('Weight Loss', 30, 'female', 65, 160, 'moderate', 'lose', 25)">
                        <div class="profile-icon">üìâ</div>
                        <div class="profile-title">Weight Loss</div>
                        <div class="profile-description">30F, 65kg, moderate activity, weight loss goal</div>
                    </div>
                    
                    <div class="profile-card" onclick="setProfile('Muscle Gain', 25, 'male', 75, 175, 'active', 'gain', 15)">
                        <div class="profile-icon">üí™</div>
                        <div class="profile-title">Muscle Gain</div>
                        <div class="profile-description">25M, 75kg, active lifestyle, muscle building</div>
                    </div>
                    
                    <div class="profile-card" onclick="setProfile('Maintenance', 35, 'female', 60, 165, 'moderate', 'maintain', 22)">
                        <div class="profile-icon">‚öñÔ∏è</div>
                        <div class="profile-title">Maintenance</div>
                        <div class="profile-description">35F, 60kg, moderate activity, weight maintenance</div>
                    </div>
                    
                    <div class="profile-card" onclick="setProfile('Athlete', 28, 'male', 80, 180, 'very_active', 'maintain', 12)">
                        <div class="profile-icon">üèÉ</div>
                        <div class="profile-title">Athlete</div>
                        <div class="profile-description">28M, 80kg, very active, performance focus</div>
                    </div>
                    
                    <div class="profile-card" onclick="setProfile('Senior', 65, 'male', 70, 170, 'light', 'maintain', 28)">
                        <div class="profile-icon">üëµ</div>
                        <div class="profile-title">Senior</div>
                        <div class="profile-description">65M, 70kg, light activity, health maintenance</div>
                    </div>
                    
                    <div class="profile-card" onclick="setProfile('Office Worker', 32, 'female', 55, 160, 'sedentary', 'lose', 30)">
                        <div class="profile-icon">üíº</div>
                        <div class="profile-title">Office Worker</div>
                        <div class="profile-description">32F, 55kg, sedentary job, weight loss</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Macro calculator state
        let macroHistory = JSON.parse(localStorage.getItem('macroHistory')) || {};
        let currentCalculation = null;
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Set default values
            document.getElementById('age').value = '30';
            document.getElementById('gender').value = 'male';
            document.getElementById('weight').value = '70';
            document.getElementById('height').value = '170';
            document.getElementById('activityLevel').value = 'moderate';
            document.getElementById('goal').value = 'maintain';
            document.getElementById('bodyFat').value = '20';
            
            // Calculate initial macros
            calculateMacros();
        });
        
        // Set profile
        function setProfile(name, age, gender, weight, height, activityLevel, goal, bodyFat) {
            document.getElementById('age').value = age;
            document.getElementById('gender').value = gender;
            document.getElementById('weight').value = weight;
            document.getElementById('height').value = height;
            document.getElementById('activityLevel').value = activityLevel;
            document.getElementById('goal').value = goal;
            document.getElementById('bodyFat').value = bodyFat;
            
            // Calculate immediately
            calculateMacros();
            
            showMessage(`Set to ${name} profile`);
        }
        
        // Show message
        function showMessage(message) {
            const messageEl = document.createElement('div');
            messageEl.textContent = message;
            messageEl.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--primary-color);
                color: white;
                padding: 15px 20px;
                border-radius: var(--border-radius);
                z-index: 1000;
                animation: slideIn 0.3s ease-out;
            `;
            
            document.body.appendChild(messageEl);
            
            setTimeout(() => {
                messageEl.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    document.body.removeChild(messageEl);
                }, 300);
            }, 3000);
        }
        
        // Calculate macro nutrients
        function calculateMacros() {
            const age = parseInt(document.getElementById('age').value) || 30;
            const gender = document.getElementById('gender').value;
            const weight = parseFloat(document.getElementById('weight').value) || 70;
            const height = parseInt(document.getElementById('height').value) || 170;
            const activityLevel = document.getElementById('activityLevel').value;
            const goal = document.getElementById('goal').value;
            const bodyFat = parseFloat(document.getElementById('bodyFat').value) || 20;
            
            try {
                // Calculate BMR using Mifflin-St Jeor Equation
                let bmr;
                if (gender === 'male') {
                    bmr = (10 * weight) + (6.25 * height) - (5 * age) + 5;
                } else {
                    bmr = (10 * weight) + (6.25 * height) - (5 * age) - 161;
                }
                
                // Apply activity multiplier
                const activityMultipliers = {
                    'sedentary': 1.2,
                    'light': 1.375,
                    'moderate': 1.55,
                    'active': 1.725,
                    'very_active': 1.9
                };
                
                let tdee = bmr * (activityMultipliers[activityLevel] || 1.55);
                
                // Apply goal adjustment
                const goalAdjustments = {
                    'lose': 0.85, // 15% deficit
                    'maintain': 1.0, // no change
                    'gain': 1.15 // 15% surplus
                };
                
                tdee *= (goalAdjustments[goal] || 1.0);
                
                // Calculate lean body mass
                const leanBodyMass = weight * (1 - bodyFat / 100);
                
                // Calculate macros
                const protein = Math.round(leanBodyMass * 2.2); // 2.2g per kg lean body mass
                const fats = Math.round(tdee * 0.3 / 9); // 30% of calories from fat
                const carbs = Math.round((tdee - (protein * 4) - (fats * 9)) / 4); // Remaining calories from carbs
                
                // Store calculation
                currentCalculation = {
                    age,
                    gender,
                    weight,
                    height,
                    activityLevel,
                    goal,
                    bodyFat,
                    bmr: Math.round(bmr),
                    tdee: Math.round(tdee),
                    protein,
                    fats,
                    carbs,
                    calculatedAt: new Date().toISOString()
                };
                
                // Update display
                updateDisplay();
                updateStats();
                updateMacroBreakdown();
                updateMacroChart();
                updateNutritionRecommendations();
                
            } catch (error) {
                alert('Error calculating macros. Please check your inputs.');
                console.error('Calculation error:', error);
            }
        }
        
        // Update display
        function updateDisplay() {
            if (!currentCalculation) return;
            
            document.getElementById('displayCalories').textContent = currentCalculation.tdee.toLocaleString();
            document.getElementById('displayBreakdown').textContent = `${currentCalculation.goal} weight, ${currentCalculation.activityLevel} activity`;
        }
        
        // Update statistics
        function updateStats() {
            if (!currentCalculation) return;
            
            document.getElementById('statCalories').textContent = currentCalculation.tdee.toLocaleString();
            document.getElementById('statProtein').textContent = currentCalculation.protein;
            document.getElementById('statCarbs').textContent = currentCalculation.carbs;
            document.getElementById('statFats').textContent = currentCalculation.fats;
        }
        
        // Update macro breakdown
        function updateMacroBreakdown() {
            if (!currentCalculation) return;
            
            const container = document.getElementById('macroBreakdown');
            container.innerHTML = '';
            
            const macros = [
                {
                    name: 'Protein',
                    amount: currentCalculation.protein,
                    unit: 'g',
                    calories: currentCalculation.protein * 4,
                    percentage: Math.round((currentCalculation.protein * 4 / currentCalculation.tdee) * 100),
                    description: 'Essential for muscle repair, growth, and maintenance. Important for satiety and metabolism.',
                    color: '#ef4444'
                },
                {
                    name: 'Carbohydrates',
                    amount: currentCalculation.carbs,
                    unit: 'g',
                    calories: currentCalculation.carbs * 4,
                    percentage: Math.round((currentCalculation.carbs * 4 / currentCalculation.tdee) * 100),
                    description: 'Primary fuel source for energy, especially important for brain function and exercise performance.',
                    color: '#3b82f6'
                },
                {
                    name: 'Fats',
                    amount: currentCalculation.fats,
                    unit: 'g',
                    calories: currentCalculation.fats * 9,
                    percentage: Math.round((currentCalculation.fats * 9 / currentCalculation.tdee) * 100),
                    description: 'Important for hormone production, nutrient absorption, and providing essential fatty acids.',
                    color: '#f59e0b'
                }
            ];
            
            macros.forEach((macro, index) => {
                const macroDiv = document.createElement('div');
                macroDiv.className = 'macro-item';
                
                macroDiv.innerHTML = `
                    <div class="macro-header">
                        <div class="macro-name">
                            <span class="macro-color" style="background: ${macro.color}"></span>
                            ${macro.name}
                        </div>
                        <div class="macro-amount">${macro.amount} ${macro.unit}</div>
                    </div>
                    <div class="macro-details">
                        <div class="detail-item">
                            <div class="detail-label">Calories</div>
                            <div class="detail-value">${macro.calories}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Percentage</div>
                            <div class="detail-value">${macro.percentage}%</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Per Meal</div>
                            <div class="detail-value">${Math.round(macro.amount / 3)} ${macro.unit}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Daily Range</div>
                            <div class="detail-value">¬±${Math.round(macro.amount * 0.1)} ${macro.unit}</div>
                        </div>
                    </div>
                    <div class="macro-description">${macro.description}</div>
                `;
                
                container.appendChild(macroDiv);
            });
        }
        
        // Update macro chart
        function updateMacroChart() {
            if (!currentCalculation) return;
            
            const container = document.getElementById('macroChart');
            container.innerHTML = '';
            
            const macros = [
                { name: 'Protein', value: currentCalculation.protein * 4, color: '#ef4444', class: 'protein' },
                { name: 'Carbs', value: currentCalculation.carbs * 4, color: '#3b82f6', class: 'carbs' },
                { name: 'Fats', value: currentCalculation.fats * 9, color: '#f59e0b', class: 'fats' }
            ];
            
            const maxCalories = Math.max(...macros.map(m => m.value));
            
            macros.forEach((macro, index) => {
                const macroDiv = document.createElement('div');
                macroDiv.className = `macro-bar ${macro.class}`;
                
                // Calculate height based on calories
                const height = (macro.value / maxCalories) * 100;
                macroDiv.style.height = `${height}%`;
                
                macroDiv.innerHTML = `
                    <div class="macro-value">${Math.round(macro.value)}</div>
                    <div class="macro-label">${macro.name}</div>
                `;
                
                container.appendChild(macroDiv);
            });
        }
        
        // Update nutrition recommendations
        function updateNutritionRecommendations() {
            if (!currentCalculation) return;
            
            const container = document.getElementById('nutritionRecommendations');
            const recommendations = generateNutritionRecommendations(currentCalculation);
            
            container.innerHTML = '';
            
            recommendations.forEach(rec => {
                const recDiv = document.createElement('div');
                recDiv.className = 'recommendation-card';
                
                recDiv.innerHTML = `
                    <div class="recommendation-header">
                        <div class="recommendation-icon">${rec.icon}</div>
                        <div class="recommendation-title">${rec.title}</div>
                    </div>
                    <div class="recommendation-description">${rec.description}</div>
                `;
                
                container.appendChild(recDiv);
            });
        }
        
        // Generate nutrition recommendations
        function generateNutritionRecommendations(calculation) {
            const recommendations = [];
            
            recommendations.push({
                icon: 'üçΩÔ∏è',
                title: 'Meal Distribution',
                description: `Spread your ${calculation.tdee} calories across 3-4 meals per day. Aim for ${Math.round(calculation.protein / 3)}g protein, ${Math.round(calculation.carbs / 3)}g carbs, and ${Math.round(calculation.fats / 3)}g fats per meal.`
            });
            
            recommendations.push({
                icon: '‚è∞',
                title: 'Timing',
                description: `Eat protein with every meal. Have carbs before/during exercise for energy. Include healthy fats with meals for satiety and nutrient absorption.`
            });
            
            recommendations.push({
                icon: 'ü•ó',
                title: 'Food Quality',
                description: `Choose lean proteins (chicken, fish, eggs), complex carbs (oats, rice, vegetables), and healthy fats (nuts, avocado, olive oil). Minimize processed foods.`
            });
            
            if (calculation.goal === 'lose') {
                recommendations.push({
                    icon: 'üìâ',
                    title: 'Weight Loss Tips',
                    description: `Focus on high-protein foods to maintain muscle mass. Include plenty of fiber from vegetables. Stay hydrated and consider intermittent fasting if it fits your lifestyle.`
                });
            } else if (calculation.goal === 'gain') {
                recommendations.push({
                    icon: 'üìà',
                    title: 'Weight Gain Tips',
                    description: `Eat calorie-dense foods like nuts, avocados, and whole milk. Have a protein shake after workouts. Consider eating 5-6 smaller meals throughout the day.`
                });
            }
            
            recommendations.push({
                icon: 'üíß',
                title: 'Hydration',
                description: `Drink at least ${Math.round(calculation.weight * 0.033)} liters of water per day. Increase intake during exercise and hot weather.`
            });
            
            return recommendations;
        }
        
        // Reset calculator
        function resetCalculator() {
            document.getElementById('age').value = '30';
            document.getElementById('gender').value = 'male';
            document.getElementById('weight').value = '70';
            document.getElementById('height').value = '170';
            document.getElementById('activityLevel').value = 'moderate';
            document.getElementById('goal').value = 'maintain';
            document.getElementById('bodyFat').value = '20';
            
            // Clear display
            currentCalculation = null;
            updateDisplay();
            
            // Reset display values
            document.getElementById('displayCalories').textContent = '2,100';
            document.getElementById('displayBreakdown').textContent = 'Based on your inputs';
            
            // Reset stats
            document.getElementById('statCalories').textContent = '2,100';
            document.getElementById('statProtein').textContent = '140';
            document.getElementById('statCarbs').textContent = '210';
            document.getElementById('statFats').textContent = '70';
            
            // Clear breakdown, chart, and recommendations
            document.getElementById('macroBreakdown').innerHTML = '';
            document.getElementById('macroChart').innerHTML = '';
            document.getElementById('nutritionRecommendations').innerHTML = '';
        }
        
        // Save calculation
        function saveCalculation() {
            if (!currentCalculation) {
                alert('Please calculate macros first.');
                return;
            }
            
            const calculation = {
                ...currentCalculation,
                id: Date.now()
            };
            
            macroHistory[calculation.calculatedAt.split('T')[0]] = calculation;
            localStorage.setItem('macroHistory', JSON.stringify(macroHistory));
            
            alert('Calculation saved successfully!');
        }
        
        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
