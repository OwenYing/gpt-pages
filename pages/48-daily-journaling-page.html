<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Journaling Page - GPT Static Pages</title>
    <link rel="stylesheet" href="../styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .journal-container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .journal-header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .journal-date {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 10px;
            font-family: 'Space Grotesk', sans-serif;
        }
        
        .journal-subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            margin-bottom: 20px;
        }
        
        .journal-form {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .form-section {
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.3s ease;
            resize: vertical;
        }
        
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .form-group textarea {
            min-height: 120px;
        }
        
        .mood-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }
        
        .mood-option {
            text-align: center;
            padding: 15px 10px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg-tertiary);
        }
        
        .mood-option:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }
        
        .mood-option.selected {
            border-color: var(--primary-color);
            background: var(--primary-color);
            color: white;
        }
        
        .mood-emoji {
            font-size: 2rem;
            margin-bottom: 8px;
            display: block;
        }
        
        .mood-label {
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .gratitude-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .gratitude-item {
            background: var(--bg-tertiary);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
        }
        
        .gratitude-item:focus-within {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }
        
        .gratitude-item input {
            border: none;
            background: transparent;
            font-size: 0.9rem;
            padding: 0;
            margin: 0;
        }
        
        .gratitude-item input:focus {
            outline: none;
        }
        
        .journal-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .journal-btn {
            padding: 15px 30px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .journal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .journal-btn.primary {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .journal-btn.primary:hover {
            background: var(--primary-dark);
        }
        
        .journal-history {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .history-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 25px;
            text-align: center;
        }
        
        .history-filters {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 10px 20px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .filter-btn:hover, .filter-btn.active {
            border-color: var(--primary-color);
            background: var(--primary-color);
            color: white;
        }
        
        .history-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .history-item {
            background: var(--bg-tertiary);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .history-item:hover {
            border-color: var(--primary-color);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .history-date {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .history-mood {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .history-summary {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 15px;
            max-height: 80px;
            overflow: hidden;
        }
        
        .history-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        .journal-stats {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .stats-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 25px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }
        
        .stat-item {
            background: var(--bg-tertiary);
            padding: 20px;
            border-radius: 10px;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 8px;
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .journal-prompts {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .prompts-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 25px;
            text-align: center;
        }
        
        .prompts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .prompt-item {
            background: var(--bg-tertiary);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .prompt-item:hover {
            border-color: var(--primary-color);
            transform: translateY(-3px);
        }
        
        .prompt-text {
            color: var(--text-primary);
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .prompt-category {
            background: var(--primary-color);
            color: white;
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 500;
        }
        
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--primary-color);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: var(--border-radius);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .back-button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .page-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        .page-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 0;
            background: var(--gradient-primary);
            color: white;
            border-radius: var(--border-radius);
            position: relative;
            overflow: hidden;
        }
        
        .page-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="50" cy="10" r="0.5" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.3;
        }
        
        .page-header-content {
            position: relative;
            z-index: 2;
        }
        
        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 16px;
            font-family: 'Space Grotesk', sans-serif;
        }
        
        .page-meta {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .page-category-badge {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .page-number-badge {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .content-section {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: var(--shadow-md);
        }
        
        @media (max-width: 768px) {
            .mood-selector {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .gratitude-list {
                grid-template-columns: 1fr;
            }
            
            .journal-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .journal-btn {
                width: 100%;
                max-width: 300px;
                justify-content: center;
            }
            
            .history-filters {
                flex-direction: column;
                align-items: center;
            }
            
            .filter-btn {
                width: 100%;
                max-width: 200px;
            }
            
            .history-grid {
                grid-template-columns: 1fr;
            }
            
            .prompts-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body class="individual-page">
    <a href="../index.html" class="back-button">
        <i class="fas fa-arrow-left"></i> Back to Hub
    </a>
    
    <div class="container">
        <div class="page-content">
            <!-- Page Header -->
            <div class="page-header">
                <div class="page-header-content">
                    <h1 class="page-title">Daily Journaling Page</h1>
                    <div class="page-meta">
                        <span class="page-category-badge">Writing & Creativity</span>
                        <span class="page-number-badge">Page #48</span>
                    </div>
                </div>
            </div>

            <!-- Introduction -->
            <div class="content-section">
                <p>Reflect on your day with our comprehensive journaling tool! Capture your thoughts, feelings, and experiences with guided prompts, mood tracking, and gratitude practice. Perfect for personal growth, mindfulness, and creating a meaningful record of your journey.</p>
            </div>

            <!-- Journal Header -->
            <div class="content-section">
                <div class="journal-header">
                    <div class="journal-date" id="journalDate">Loading...</div>
                    <div class="journal-subtitle">Take a moment to reflect on your day</div>
                </div>
            </div>

            <!-- Journal Form -->
            <div class="content-section">
                <div class="journal-form">
                    <form id="journalForm">
                        <!-- Mood Section -->
                        <div class="form-section">
                            <div class="section-title">
                                <i class="fas fa-heart"></i>
                                How are you feeling today?
                            </div>
                            <div class="mood-selector" id="moodSelector">
                                <div class="mood-option" data-mood="excellent">
                                    <span class="mood-emoji">😊</span>
                                    <div class="mood-label">Excellent</div>
                                </div>
                                <div class="mood-option" data-mood="good">
                                    <span class="mood-emoji">🙂</span>
                                    <div class="mood-label">Good</div>
                                </div>
                                <div class="mood-option" data-mood="okay">
                                    <span class="mood-emoji">😐</span>
                                    <div class="mood-label">Okay</div>
                                </div>
                                <div class="mood-option" data-mood="bad">
                                    <span class="mood-emoji">😔</span>
                                    <div class="mood-label">Bad</div>
                                </div>
                                <div class="mood-option" data-mood="terrible">
                                    <span class="mood-emoji">😢</span>
                                    <div class="mood-label">Terrible</div>
                                </div>
                            </div>
                        </div>

                        <!-- Daily Summary -->
                        <div class="form-section">
                            <div class="section-title">
                                <i class="fas fa-book-open"></i>
                                Daily Summary
                            </div>
                            <div class="form-group">
                                <label for="dailySummary">What happened today? (Brief overview)</label>
                                <textarea id="dailySummary" placeholder="Describe the main events and highlights of your day..."></textarea>
                            </div>
                        </div>

                        <!-- High Points -->
                        <div class="form-section">
                            <div class="section-title">
                                <i class="fas fa-star"></i>
                                High Points
                            </div>
                            <div class="form-group">
                                <label for="highPoints">What were the best moments of your day?</label>
                                <textarea id="highPoints" placeholder="What made you smile, laugh, or feel accomplished today?"></textarea>
                            </div>
                        </div>

                        <!-- Challenges -->
                        <div class="form-section">
                            <div class="section-title">
                                <i class="fas fa-mountain"></i>
                                Challenges & Growth
                            </div>
                            <div class="form-group">
                                <label for="challenges">What challenges did you face today?</label>
                                <textarea id="challenges" placeholder="What difficulties did you encounter? How did you handle them? What did you learn?"></textarea>
                            </div>
                        </div>

                        <!-- Gratitude -->
                        <div class="form-section">
                            <div class="section-title">
                                <i class="fas fa-hands-praying"></i>
                                Gratitude Practice
                            </div>
                            <div class="form-group">
                                <label>What are you grateful for today? (List 3 things)</label>
                                <div class="gratitude-list">
                                    <div class="gratitude-item">
                                        <input type="text" placeholder="I'm grateful for..." id="gratitude1">
                                    </div>
                                    <div class="gratitude-item">
                                        <input type="text" placeholder="I'm grateful for..." id="gratitude2">
                                    </div>
                                    <div class="gratitude-item">
                                        <input type="text" placeholder="I'm grateful for..." id="gratitude3">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Goals & Intentions -->
                        <div class="form-section">
                            <div class="section-title">
                                <i class="fas fa-bullseye"></i>
                                Goals & Intentions
                            </div>
                            <div class="form-group">
                                <label for="goals">What are your goals for tomorrow?</label>
                                <textarea id="goals" placeholder="What would you like to accomplish or focus on tomorrow?"></textarea>
                            </div>
                        </div>

                        <!-- Reflection -->
                        <div class="form-section">
                            <div class="section-title">
                                <i class="fas fa-lightbulb"></i>
                                Personal Reflection
                            </div>
                            <div class="form-group">
                                <label for="reflection">Any additional thoughts, insights, or feelings you'd like to capture?</label>
                                <textarea id="reflection" placeholder="This is your space for deeper reflection, creative thoughts, or anything else on your mind..."></textarea>
                            </div>
                        </div>

                        <!-- Journal Actions -->
                        <div class="journal-actions">
                            <button type="button" class="journal-btn" onclick="clearForm()">
                                <i class="fas fa-eraser"></i> Clear
                            </button>
                            <button type="button" class="journal-btn" onclick="saveJournal()">
                                <i class="fas fa-save"></i> Save Draft
                            </button>
                            <button type="submit" class="journal-btn primary">
                                <i class="fas fa-check"></i> Complete Entry
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Journal Prompts -->
            <div class="content-section">
                <div class="journal-prompts">
                    <div class="prompts-title">Journaling Prompts</div>
                    
                    <div class="prompts-grid">
                        <div class="prompt-item" onclick="usePrompt('What made you feel most alive today?')">
                            <div class="prompt-text">What made you feel most alive today?</div>
                            <div class="prompt-category">Reflection</div>
                        </div>
                        
                        <div class="prompt-item" onclick="usePrompt('Describe a moment when you felt proud of yourself.')">
                            <div class="prompt-text">Describe a moment when you felt proud of yourself.</div>
                            <div class="prompt-category">Achievement</div>
                        </div>
                        
                        <div class="prompt-item" onclick="usePrompt('What would you tell your future self about today?')">
                            <div class="prompt-text">What would you tell your future self about today?</div>
                            <div class="prompt-category">Perspective</div>
                        </div>
                        
                        <div class="prompt-item" onclick="usePrompt('How did you show kindness to yourself or others today?')">
                            <div class="prompt-text">How did you show kindness to yourself or others today?</div>
                            <div class="prompt-category">Kindness</div>
                        </div>
                        
                        <div class="prompt-item" onclick="usePrompt('What's something you learned about yourself today?')">
                            <div class="prompt-text">What's something you learned about yourself today?</div>
                            <div class="prompt-category">Self-Discovery</div>
                        </div>
                        
                        <div class="prompt-item" onclick="usePrompt('Describe a challenge you overcame and how it made you stronger.')">
                            <div class="prompt-text">Describe a challenge you overcame and how it made you stronger.</div>
                            <div class="prompt-category">Growth</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Journal Statistics -->
            <div class="content-section">
                <div class="journal-stats">
                    <div class="stats-title">Your Journaling Journey</div>
                    
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="totalEntries">0</div>
                            <div class="stat-label">Total Entries</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="currentStreak">0</div>
                            <div class="stat-label">Day Streak</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="avgMood">😊</div>
                            <div class="stat-label">Average Mood</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="totalWords">0</div>
                            <div class="stat-label">Words Written</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Journal History -->
            <div class="content-section">
                <div class="journal-history">
                    <div class="history-title">Recent Journal Entries</div>
                    
                    <div class="history-filters">
                        <button class="filter-btn active" data-filter="all">All Entries</button>
                        <button class="filter-btn" data-filter="recent">Recent</button>
                        <button class="filter-btn" data-filter="mood">By Mood</button>
                        <button class="filter-btn" data-filter="search">Search</button>
                    </div>
                    
                    <div class="history-grid" id="historyGrid">
                        <!-- History items will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedMood = null;
        let journalEntries = JSON.parse(localStorage.getItem('journalEntries')) || [];
        let journalStats = JSON.parse(localStorage.getItem('journalStats')) || {
            totalEntries: 0,
            currentStreak: 0,
            totalWords: 0,
            moodCounts: {}
        };

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            updateDate();
            updateStats();
            renderHistory();
        });

        function setupEventListeners() {
            // Mood selector
            document.querySelectorAll('.mood-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.mood-option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedMood = this.dataset.mood;
                });
            });
            
            // Form submission
            document.getElementById('journalForm').addEventListener('submit', function(e) {
                e.preventDefault();
                submitJournal();
            });
            
            // Filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    filterHistory(this.dataset.filter);
                });
            });
        }

        function updateDate() {
            const today = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            document.getElementById('journalDate').textContent = today.toLocaleDateString('en-US', options);
        }

        function submitJournal() {
            if (!selectedMood) {
                alert('Please select your mood for today.');
                return;
            }
            
            const entry = {
                id: Date.now(),
                date: new Date().toISOString(),
                mood: selectedMood,
                summary: document.getElementById('dailySummary').value,
                highPoints: document.getElementById('highPoints').value,
                challenges: document.getElementById('challenges').value,
                gratitude: [
                    document.getElementById('gratitude1').value,
                    document.getElementById('gratitude2').value,
                    document.getElementById('gratitude3').value
                ].filter(g => g.trim()),
                goals: document.getElementById('goals').value,
                reflection: document.getElementById('reflection').value,
                wordCount: calculateWordCount()
            };
            
            journalEntries.unshift(entry);
            
            // Keep only last 100 entries
            if (journalEntries.length > 100) {
                journalEntries = journalEntries.slice(0, 100);
            }
            
            localStorage.setItem('journalEntries', JSON.stringify(journalEntries));
            updateStats();
            renderHistory();
            clearForm();
            
            alert('Journal entry saved successfully!');
        }

        function calculateWordCount() {
            const fields = ['dailySummary', 'highPoints', 'challenges', 'goals', 'reflection'];
            let totalWords = 0;
            
            fields.forEach(fieldId => {
                const value = document.getElementById(fieldId).value;
                if (value.trim()) {
                    totalWords += value.split(/\s+/).length;
                }
            });
            
            return totalWords;
        }

        function clearForm() {
            document.getElementById('journalForm').reset();
            document.querySelectorAll('.mood-option').forEach(o => o.classList.remove('selected'));
            selectedMood = null;
        }

        function saveJournal() {
            // Save current form state as draft
            const draft = {
                mood: selectedMood,
                summary: document.getElementById('dailySummary').value,
                highPoints: document.getElementById('highPoints').value,
                challenges: document.getElementById('challenges').value,
                gratitude: [
                    document.getElementById('gratitude1').value,
                    document.getElementById('gratitude2').value,
                    document.getElementById('gratitude3').value
                ],
                goals: document.getElementById('goals').value,
                reflection: document.getElementById('reflection').value
            };
            
            localStorage.setItem('journalDraft', JSON.stringify(draft));
            alert('Draft saved! You can continue later.');
        }

        function usePrompt(promptText) {
            document.getElementById('reflection').value = promptText;
            document.getElementById('reflection').focus();
        }

        function updateStats() {
            journalStats.totalEntries = journalEntries.length;
            journalStats.totalWords = journalEntries.reduce((sum, entry) => sum + entry.wordCount, 0);
            
            // Calculate current streak
            let streak = 0;
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            for (let i = 0; i < journalEntries.length; i++) {
                const entryDate = new Date(journalEntries[i].date);
                entryDate.setHours(0, 0, 0, 0);
                
                const diffTime = today - entryDate;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays === streak) {
                    streak++;
                } else {
                    break;
                }
            }
            
            journalStats.currentStreak = streak;
            
            // Calculate average mood
            const moodEmojis = {
                'excellent': '😊',
                'good': '🙂',
                'okay': '😐',
                'bad': '😔',
                'terrible': '😢'
            };
            
            if (journalEntries.length > 0) {
                const recentMoods = journalEntries.slice(0, 7).map(entry => entry.mood);
                const mostCommonMood = recentMoods.sort((a, b) => 
                    recentMoods.filter(v => v === a).length - recentMoods.filter(v => v === b).length
                ).pop();
                journalStats.avgMood = moodEmojis[mostCommonMood] || '😊';
            }
            
            document.getElementById('totalEntries').textContent = journalStats.totalEntries;
            document.getElementById('currentStreak').textContent = journalStats.currentStreak;
            document.getElementById('avgMood').textContent = journalStats.avgMood;
            document.getElementById('totalWords').textContent = journalStats.totalWords;
            
            localStorage.setItem('journalStats', JSON.stringify(journalStats));
        }

        function renderHistory() {
            const historyGrid = document.getElementById('historyGrid');
            historyGrid.innerHTML = '';
            
            if (journalEntries.length === 0) {
                historyGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--text-secondary);">
                        <i class="fas fa-book" style="font-size: 3rem; margin-bottom: 20px; display: block;"></i>
                        <h3>No journal entries yet</h3>
                        <p>Complete your first journal entry to see it here!</p>
                    </div>
                `;
                return;
            }
            
            journalEntries.forEach(entry => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.onclick = () => viewEntry(entry);
                
                const moodEmojis = {
                    'excellent': '😊',
                    'good': '🙂',
                    'okay': '😐',
                    'bad': '😔',
                    'terrible': '😢'
                };
                
                const entryDate = new Date(entry.date);
                const dateString = entryDate.toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric',
                    year: 'numeric'
                });
                
                const summary = entry.summary || entry.highPoints || entry.reflection || 'No summary available';
                const truncatedSummary = summary.length > 100 ? summary.substring(0, 100) + '...' : summary;
                
                historyItem.innerHTML = `
                    <div class="history-date">${dateString}</div>
                    <div class="history-mood">${moodEmojis[entry.mood]}</div>
                    <div class="history-summary">${truncatedSummary}</div>
                    <div class="history-meta">
                        <span>${entry.wordCount} words</span>
                        <span>${entry.gratitude.length} gratitudes</span>
                    </div>
                `;
                
                historyGrid.appendChild(historyItem);
            });
        }

        function viewEntry(entry) {
            const moodEmojis = {
                'excellent': '😊',
                'good': '🙂',
                'okay': '😐',
                'bad': '😔',
                'terrible': '😢'
            };
            
            const entryDate = new Date(entry.date);
            const dateString = entryDate.toLocaleDateString('en-US', { 
                weekday: 'long',
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            const gratitudeList = entry.gratitude.map(g => `• ${g}`).join('\n');
            
            const entryText = `
Journal Entry - ${dateString}

Mood: ${moodEmojis[entry.mood]} ${entry.mood.charAt(0).toUpperCase() + entry.mood.slice(1)}

Daily Summary:
${entry.summary || 'No summary provided'}

High Points:
${entry.highPoints || 'No high points recorded'}

Challenges & Growth:
${entry.challenges || 'No challenges recorded'}

Gratitude:
${gratitudeList || 'No gratitude items recorded'}

Goals for Tomorrow:
${entry.goals || 'No goals set'}

Personal Reflection:
${entry.reflection || 'No reflection provided'}

Word Count: ${entry.wordCount}
            `;
            
            alert(entryText);
        }

        function filterHistory(filterType) {
            // This would implement different filtering logic
            // For now, just re-render the history
            renderHistory();
        }

        // Load draft on page load
        window.addEventListener('load', function() {
            const draft = localStorage.getItem('journalDraft');
            if (draft) {
                try {
                    const draftData = JSON.parse(draft);
                    if (draftData.mood) {
                        document.querySelector(`[data-mood="${draftData.mood}"]`).classList.add('selected');
                        selectedMood = draftData.mood;
                    }
                    if (draftData.summary) document.getElementById('dailySummary').value = draftData.summary;
                    if (draftData.highPoints) document.getElementById('highPoints').value = draftData.highPoints;
                    if (draftData.challenges) document.getElementById('challenges').value = draftData.challenges;
                    if (draftData.gratitude) {
                        draftData.gratitude.forEach((g, i) => {
                            if (g && document.getElementById(`gratitude${i + 1}`)) {
                                document.getElementById(`gratitude${i + 1}`).value = g;
                            }
                        });
                    }
                    if (draftData.goals) document.getElementById('goals').value = draftData.goals;
                    if (draftData.reflection) document.getElementById('reflection').value = draftData.reflection;
                } catch (e) {
                    console.log('Could not load draft');
                }
            }
        });
    </script>
</body>
</html>
